% -*- mode: noweb; ess-noweb-default-code-mode: lisp-mode; -*-% ===> this file was generated automatically by noweave --- better not edit it
\documentclass{tufte-handout}

\input{preamble.tex}

\hypersetup{
  pdffitwindow=true,
  pdfstartview={FitH},
  pdftitle={The Wizard's Adventure Game},
  pdfauthor={Eric Bailey <eric@ericb.me>},
  pdfsubject={Land of Lisp: Chapter 5},
  pdfkeywords={Lisp, game, literate programming, noweb},
  colorlinks=true,
  linkcolor=ErlangRed,
  urlcolor=ErlangRed
}

\title{%
  The Wizard's Adventure Game
  \thanks{\cite{barski2010land-ch5}}
}

\date{%
  October 14, 2017
  \thanks{Last updated \today}
}

\begin{document}
\maketitle
\nwfilename{src/wizard5.nw}\nwbegindocs{1}\nwdocspar

\begin{abstract}
  In this game, you are a wizard's apprentice. \\
  \noindent You'll explore the wizard's house.
\end{abstract}

\tableofcontents

\nwenddocs{}\nwbegincode{2}\sublabel{NWNVxch-1p0Y9w-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\endmoddef\nwstartdeflinemarkup\nwprevnextdefs{\relax}{NWNVxch-1p0Y9w-2}\nwenddeflinemarkup
(in-package :cl-user)
(defpackage \nwlinkedidentc{lol.wizard5}{NWNVxch-1p0Y9w-1}
  (:use :cl)
  (:export :\nwlinkedidentc{look}{NWNVxch-1p0Y9w-8}
           :\nwlinkedidentc{walk}{NWNVxch-1p0Y9w-9}
           :\nwlinkedidentc{pickup}{NWNVxch-1p0Y9w-A}
           :\nwlinkedidentc{inventory}{NWNVxch-1p0Y9w-B}))
(in-package :\nwlinkedidentc{lol.wizard5}{NWNVxch-1p0Y9w-1})


\nwindexdefn{\nwixident{lol.wizard5}}{lol.wizard5}{NWNVxch-1p0Y9w-1}\eatline
\nwalsodefined{\\{NWNVxch-1p0Y9w-2}\\{NWNVxch-1p0Y9w-3}\\{NWNVxch-1p0Y9w-4}\\{NWNVxch-1p0Y9w-5}\\{NWNVxch-1p0Y9w-6}\\{NWNVxch-1p0Y9w-7}\\{NWNVxch-1p0Y9w-8}\\{NWNVxch-1p0Y9w-9}\\{NWNVxch-1p0Y9w-A}\\{NWNVxch-1p0Y9w-B}}\nwnotused{*}\nwidentdefs{\\{{\nwixident{lol.wizard5}}{lol.wizard5}}}\nwidentuses{\\{{\nwixident{inventory}}{inventory}}\\{{\nwixident{look}}{look}}\\{{\nwixident{pickup}}{pickup}}\\{{\nwixident{walk}}{walk}}}\nwindexuse{\nwixident{inventory}}{inventory}{NWNVxch-1p0Y9w-1}\nwindexuse{\nwixident{look}}{look}{NWNVxch-1p0Y9w-1}\nwindexuse{\nwixident{pickup}}{pickup}{NWNVxch-1p0Y9w-1}\nwindexuse{\nwixident{walk}}{walk}{NWNVxch-1p0Y9w-1}\nwendcode{}\nwbegindocs{3}\nwdocspar
\newpage
\section{Setting the Scene}

This world consists of only three locations:

\begin{marginfigure}
\nwenddocs{}\nwbegincode{4}\sublabel{NWNVxch-1p0Y9w-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-2}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-1}{NWNVxch-1p0Y9w-3}\nwenddeflinemarkup
\LA{}define the global variables~{\nwtagstyle{}\subpageref{NWNVxch-tHqk1-1}}\RA{}
\nwendcode{}\nwbegindocs{5}\nwdocspar

\nwenddocs{}\nwbegincode{6}\sublabel{NWNVxch-ozR14-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-ozR14-1}}}\moddef{living-room description~{\nwtagstyle{}\subpageref{NWNVxch-ozR14-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-tHqk1-1}\\{NWNVxch-1cAtyV-1}\\{NWNVxch-1cAtyV-6}\\{NWNVxch-386mef-1}\\{NWNVxch-3XNgJW-1}}\nwenddeflinemarkup
you are in the living room.
a wizard is snoring loudly on the couch.
\nwused{\\{NWNVxch-tHqk1-1}\\{NWNVxch-1cAtyV-1}\\{NWNVxch-1cAtyV-6}\\{NWNVxch-386mef-1}\\{NWNVxch-3XNgJW-1}}\nwendcode{}\nwbegindocs{7}\nwdocspar

\nwenddocs{}\nwbegincode{8}\sublabel{NWNVxch-4E8Y49-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-4E8Y49-1}}}\moddef{garden description~{\nwtagstyle{}\subpageref{NWNVxch-4E8Y49-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-tHqk1-1}\\{NWNVxch-3XNgJW-1}}\nwenddeflinemarkup
you are in a beautiful garden.
there is a well in front of you.
\nwused{\\{NWNVxch-tHqk1-1}\\{NWNVxch-3XNgJW-1}}\nwendcode{}\nwbegindocs{9}\nwdocspar

\nwenddocs{}\nwbegincode{10}\sublabel{NWNVxch-2w0KS8-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2w0KS8-1}}}\moddef{attic description~{\nwtagstyle{}\subpageref{NWNVxch-2w0KS8-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-tHqk1-1}}\nwenddeflinemarkup
you are in the attic.
there is a giant welding torch in the corner.
\nwused{\\{NWNVxch-tHqk1-1}}\nwendcode{}\nwbegindocs{11}\nwdocspar
\end{marginfigure}

\begin{itemize}
  \item the living room
  \item a beautiful garden
  \item the attic
\end{itemize}


\nwenddocs{}\nwbegincode{12}\sublabel{NWNVxch-tHqk1-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-tHqk1-1}}}\moddef{define the global variables~{\nwtagstyle{}\subpageref{NWNVxch-tHqk1-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-2}}\nwprevnextdefs{\relax}{NWNVxch-tHqk1-2}\nwenddeflinemarkup
(defparameter \nwlinkedidentc{*nodes*}{NWNVxch-tHqk1-1}
  '((living-room (\LA{}living-room description~{\nwtagstyle{}\subpageref{NWNVxch-ozR14-1}}\RA{}))
    (garden      (\LA{}garden description~{\nwtagstyle{}\subpageref{NWNVxch-4E8Y49-1}}\RA{}))
    (attic       (\LA{}attic description~{\nwtagstyle{}\subpageref{NWNVxch-2w0KS8-1}}\RA{}))))

\nwindexdefn{\nwixident{*nodes*}}{*nodes*}{NWNVxch-tHqk1-1}\eatline
\nwalsodefined{\\{NWNVxch-tHqk1-2}\\{NWNVxch-tHqk1-3}\\{NWNVxch-tHqk1-4}}\nwused{\\{NWNVxch-1p0Y9w-2}}\nwidentdefs{\\{{\nwixident{*nodes*}}{*nodes*}}}\nwendcode{}\nwbegindocs{13}\nwdocspar

\section{Describing the Location}

\begin{marginfigure}
\nwenddocs{}\nwbegincode{14}\sublabel{NWNVxch-3T3roy-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-3T3roy-1}}}\moddef{look up a location~{\nwtagstyle{}\subpageref{NWNVxch-3T3roy-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-3}}\nwenddeflinemarkup
(assoc location nodes)
\nwused{\\{NWNVxch-1p0Y9w-3}}\nwendcode{}\nwbegindocs{15}\nwdocspar

\nwenddocs{}\nwbegincode{16}\sublabel{NWNVxch-1cAtyV-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-1}}}\moddef{Example Session~{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-1}}}\endmoddef\nwstartdeflinemarkup\nwprevnextdefs{\relax}{NWNVxch-1cAtyV-2}\nwenddeflinemarkup
> (\nwlinkedidentc{describe-location}{NWNVxch-1p0Y9w-3} 'living-room \nwlinkedidentc{*nodes*}{NWNVxch-tHqk1-1})
(\LA{}living-room description~{\nwtagstyle{}\subpageref{NWNVxch-ozR14-1}}\RA{})
\nwalsodefined{\\{NWNVxch-1cAtyV-2}\\{NWNVxch-1cAtyV-3}\\{NWNVxch-1cAtyV-4}\\{NWNVxch-1cAtyV-5}\\{NWNVxch-1cAtyV-6}\\{NWNVxch-1cAtyV-7}\\{NWNVxch-1cAtyV-8}}\nwnotused{Example Session}\nwidentuses{\\{{\nwixident{*nodes*}}{*nodes*}}\\{{\nwixident{describe-location}}{describe-location}}}\nwindexuse{\nwixident{*nodes*}}{*nodes*}{NWNVxch-1cAtyV-1}\nwindexuse{\nwixident{describe-location}}{describe-location}{NWNVxch-1cAtyV-1}\nwendcode{}\nwbegindocs{17}\nwdocspar
\end{marginfigure}

To find the description, {\Tt{}\LA{}look up a location~{\nwtagstyle{}\subpageref{NWNVxch-3T3roy-1}}\RA{}\nwendquote} and take the \lsp{cadr}.
Preferring the {\sl functional programming} style, pass \lsp{nodes} as an
argument, instead of referencing {\Tt{}\nwlinkedidentq{*nodes*}{NWNVxch-tHqk1-1}\nwendquote} directly.

\nwenddocs{}\nwbegincode{18}\sublabel{NWNVxch-1p0Y9w-3}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-3}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-2}{NWNVxch-1p0Y9w-4}\nwenddeflinemarkup
(defun \nwlinkedidentc{describe-location}{NWNVxch-1p0Y9w-3} (location nodes)\nwindexdefn{\nwixident{describe-location}}{describe-location}{NWNVxch-1p0Y9w-3}
  (cadr \LA{}look up a location~{\nwtagstyle{}\subpageref{NWNVxch-3T3roy-1}}\RA{}))


\nwidentdefs{\\{{\nwixident{describe-location}}{describe-location}}}\nwendcode{}\nwbegindocs{19}\nwdocspar


\section{Describing the Paths}

From the \lsp{living-room}, you can move to the \lsp{garden} by going \lsp{west}
through the \lsp{door}, or to the \lsp{attic} by going \lsp{upstairs} via the
\lsp{ladder}.

From the \lsp{garden}, you can move to the \lsp{living-room} by going \lsp{east}
through the \lsp{door}.

From the \lsp{attic}, you can move to the \lsp{living-room} by going
\lsp{downstairs} via the \lsp{ladder}.

\begin{marginfigure}
\nwenddocs{}\nwbegincode{20}\sublabel{NWNVxch-2xf4OR-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2xf4OR-1}}}\moddef{living-room paths~{\nwtagstyle{}\subpageref{NWNVxch-2xf4OR-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-tHqk1-2}}\nwenddeflinemarkup
(garden west door)
(attic upstairs ladder)
\nwused{\\{NWNVxch-tHqk1-2}}\nwendcode{}\nwbegindocs{21}\nwdocspar

\nwenddocs{}\nwbegincode{22}\sublabel{NWNVxch-1acezE-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1acezE-1}}}\moddef{garden path~{\nwtagstyle{}\subpageref{NWNVxch-1acezE-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-tHqk1-2}}\nwenddeflinemarkup
(living-room east door)
\nwused{\\{NWNVxch-tHqk1-2}}\nwendcode{}\nwbegindocs{23}\nwdocspar

\nwenddocs{}\nwbegincode{24}\sublabel{NWNVxch-2ZorP9-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2ZorP9-1}}}\moddef{attic path~{\nwtagstyle{}\subpageref{NWNVxch-2ZorP9-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-tHqk1-2}}\nwenddeflinemarkup
(living-room downstairs ladder)
\nwused{\\{NWNVxch-tHqk1-2}}\nwendcode{}\nwbegindocs{25}\nwdocspar

\nwenddocs{}\nwbegincode{26}\sublabel{NWNVxch-vCtwU-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-vCtwU-1}}}\moddef{garden door~{\nwtagstyle{}\subpageref{NWNVxch-vCtwU-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1cAtyV-2}\\{NWNVxch-1cAtyV-3}\\{NWNVxch-1Thvud-1}\\{NWNVxch-386mef-1}}\nwenddeflinemarkup
THERE IS A DOOR GOING WEST FROM HERE.
\nwused{\\{NWNVxch-1cAtyV-2}\\{NWNVxch-1cAtyV-3}\\{NWNVxch-1Thvud-1}\\{NWNVxch-386mef-1}}\nwendcode{}\nwbegindocs{27}\nwdocspar

\nwenddocs{}\nwbegincode{28}\sublabel{NWNVxch-1cAtyV-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-2}}}\moddef{Example Session~{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1cAtyV-1}{NWNVxch-1cAtyV-3}\nwenddeflinemarkup
> (\nwlinkedidentc{describe-path}{NWNVxch-1p0Y9w-4} '(garden west door))
\LA{}garden door~{\nwtagstyle{}\subpageref{NWNVxch-vCtwU-1}}\RA{}
\nwidentuses{\\{{\nwixident{describe-path}}{describe-path}}}\nwindexuse{\nwixident{describe-path}}{describe-path}{NWNVxch-1cAtyV-2}\nwendcode{}\nwbegindocs{29}\nwdocspar
\end{marginfigure}

\nwenddocs{}\nwbegincode{30}\sublabel{NWNVxch-tHqk1-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-tHqk1-2}}}\moddef{define the global variables~{\nwtagstyle{}\subpageref{NWNVxch-tHqk1-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-2}}\nwprevnextdefs{NWNVxch-tHqk1-1}{NWNVxch-tHqk1-3}\nwenddeflinemarkup
(defparameter \nwlinkedidentc{*edges*}{NWNVxch-tHqk1-2}
  '((living-room \LA{}living-room paths~{\nwtagstyle{}\subpageref{NWNVxch-2xf4OR-1}}\RA{})
    (garden      \LA{}garden path~{\nwtagstyle{}\subpageref{NWNVxch-1acezE-1}}\RA{})
    (attic       \LA{}attic path~{\nwtagstyle{}\subpageref{NWNVxch-2ZorP9-1}}\RA{})))

\nwindexdefn{\nwixident{*edges*}}{*edges*}{NWNVxch-tHqk1-2}\eatline
\nwused{\\{NWNVxch-1p0Y9w-2}}\nwidentdefs{\\{{\nwixident{*edges*}}{*edges*}}}\nwendcode{}\nwbegindocs{31}\nwdocspar

To describe a path, take the means (\lsp{caddr}) and direction (\lsp{cadr}) and
return a descriptive list.

\nwenddocs{}\nwbegincode{32}\sublabel{NWNVxch-1p0Y9w-4}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-4}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-3}{NWNVxch-1p0Y9w-5}\nwenddeflinemarkup
(defun \nwlinkedidentc{describe-path}{NWNVxch-1p0Y9w-4} (edge)\nwindexdefn{\nwixident{describe-path}}{describe-path}{NWNVxch-1p0Y9w-4}
  `(there is a ,(caddr edge) going ,(cadr edge) from here.))


\nwidentdefs{\\{{\nwixident{describe-path}}{describe-path}}}\nwendcode{}\nwbegindocs{33}\nwdocspar


\section{Describing Multiple Paths at Once}

To describe multiple paths:

\begin{marginfigure}
\nwenddocs{}\nwbegincode{34}\sublabel{NWNVxch-2uLI1w-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2uLI1w-1}}}\moddef{Find the relevant edges.~{\nwtagstyle{}\subpageref{NWNVxch-2uLI1w-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-5}}\nwenddeflinemarkup
(cdr (assoc location edges))
\nwused{\\{NWNVxch-1p0Y9w-5}}\nwendcode{}\nwbegindocs{35}\nwdocspar

\nwenddocs{}\nwbegincode{36}\sublabel{NWNVxch-3UGKyl-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-3UGKyl-1}}}\moddef{Convert the edges to descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-3UGKyl-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-5}}\nwenddeflinemarkup
mapcar #'describe-path
\nwused{\\{NWNVxch-1p0Y9w-5}}\nwendcode{}\nwbegindocs{37}\nwdocspar
% FIXME: @index use describe-path

\nwenddocs{}\nwbegincode{38}\sublabel{NWNVxch-2I51ok-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2I51ok-1}}}\moddef{Join the descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-2I51ok-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-5}\\{NWNVxch-1p0Y9w-7}}\nwenddeflinemarkup
apply #'append
\nwused{\\{NWNVxch-1p0Y9w-5}\\{NWNVxch-1p0Y9w-7}}\nwendcode{}\nwbegindocs{39}\nwdocspar

\nwenddocs{}\nwbegincode{40}\sublabel{NWNVxch-1nNOhz-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1nNOhz-1}}}\moddef{attic ladder~{\nwtagstyle{}\subpageref{NWNVxch-1nNOhz-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1cAtyV-3}\\{NWNVxch-1Thvud-1}}\nwenddeflinemarkup
THERE IS A LADDER GOING UPSTAIRS FROM HERE.
\nwused{\\{NWNVxch-1cAtyV-3}\\{NWNVxch-1Thvud-1}}\nwendcode{}\nwbegindocs{41}\nwdocspar

\nwenddocs{}\nwbegincode{42}\sublabel{NWNVxch-1cAtyV-3}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-3}}}\moddef{Example Session~{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1cAtyV-2}{NWNVxch-1cAtyV-4}\nwenddeflinemarkup
> (\nwlinkedidentc{describe-paths}{NWNVxch-1p0Y9w-5} 'living-room \nwlinkedidentc{*edges*}{NWNVxch-tHqk1-2})
(\LA{}garden door~{\nwtagstyle{}\subpageref{NWNVxch-vCtwU-1}}\RA{}
 \LA{}attic ladder~{\nwtagstyle{}\subpageref{NWNVxch-1nNOhz-1}}\RA{})
\nwidentuses{\\{{\nwixident{*edges*}}{*edges*}}\\{{\nwixident{describe-paths}}{describe-paths}}}\nwindexuse{\nwixident{*edges*}}{*edges*}{NWNVxch-1cAtyV-3}\nwindexuse{\nwixident{describe-paths}}{describe-paths}{NWNVxch-1cAtyV-3}\nwendcode{}\nwbegindocs{43}\nwdocspar
\end{marginfigure}

\begin{enumerate}

  \item {\Tt{}\LA{}Find the relevant edges.~{\nwtagstyle{}\subpageref{NWNVxch-2uLI1w-1}}\RA{}\nwendquote}
  \item {\Tt{}\LA{}Convert the edges to descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-3UGKyl-1}}\RA{}\nwendquote}
  \item {\Tt{}\LA{}Join the descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-2I51ok-1}}\RA{}\nwendquote}
\end{enumerate}

\nwenddocs{}\nwbegincode{44}\sublabel{NWNVxch-1p0Y9w-5}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-5}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-4}{NWNVxch-1p0Y9w-6}\nwenddeflinemarkup
(defun \nwlinkedidentc{describe-paths}{NWNVxch-1p0Y9w-5} (location edges)\nwindexdefn{\nwixident{describe-paths}}{describe-paths}{NWNVxch-1p0Y9w-5}
  (\LA{}Join the descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-2I51ok-1}}\RA{} (\LA{}Convert the edges to descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-3UGKyl-1}}\RA{} \LA{}Find the relevant edges.~{\nwtagstyle{}\subpageref{NWNVxch-2uLI1w-1}}\RA{})))


\nwidentdefs{\\{{\nwixident{describe-paths}}{describe-paths}}}\nwendcode{}\nwbegindocs{45}\nwdocspar


\section{Describing Objects at a Specific Location}

\nwenddocs{}\nwbegincode{46}\sublabel{NWNVxch-tHqk1-3}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-tHqk1-3}}}\moddef{define the global variables~{\nwtagstyle{}\subpageref{NWNVxch-tHqk1-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-2}}\nwprevnextdefs{NWNVxch-tHqk1-2}{NWNVxch-tHqk1-4}\nwenddeflinemarkup
(defparameter \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} '(whiskey bucket frog chain))\nwindexdefn{\nwixident{*objects*}}{*objects*}{NWNVxch-tHqk1-3}

(defparameter \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3}
  '((whiskey living-room)
    (bucket living-room)
    (chain garden)
    (frog garden)))

\nwindexdefn{\nwixident{*object-locations*}}{*object-locations*}{NWNVxch-tHqk1-3}\eatline
\nwused{\\{NWNVxch-1p0Y9w-2}}\nwidentdefs{\\{{\nwixident{*object-locations*}}{*object-locations*}}\\{{\nwixident{*objects*}}{*objects*}}}\nwendcode{}\nwbegindocs{47}\nwdocspar
\begin{marginfigure}
\nwenddocs{}\nwbegincode{48}\sublabel{NWNVxch-4AIHSa-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-4AIHSa-1}}}\moddef{at-loc-p~{\nwtagstyle{}\subpageref{NWNVxch-4AIHSa-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-6}}\nwenddeflinemarkup
(at-loc-p (obj)
  (eq (cadr (assoc obj obj-locs)) loc))
\nwused{\\{NWNVxch-1p0Y9w-6}}\nwendcode{}\nwbegindocs{49}\nwdocspar
\end{marginfigure}

\nwenddocs{}\nwbegincode{50}\sublabel{NWNVxch-1p0Y9w-6}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-6}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-5}{NWNVxch-1p0Y9w-7}\nwenddeflinemarkup
(defun \nwlinkedidentc{objects-at}{NWNVxch-1p0Y9w-6} (loc objs obj-locs)\nwindexdefn{\nwixident{objects-at}}{objects-at}{NWNVxch-1p0Y9w-6}
  (labels (\LA{}at-loc-p~{\nwtagstyle{}\subpageref{NWNVxch-4AIHSa-1}}\RA{})
    (remove-if-not #'at-loc-p objs)))


\nwidentdefs{\\{{\nwixident{objects-at}}{objects-at}}}\nwendcode{}\nwbegindocs{51}\nwdocspar

\nwenddocs{}\nwbegincode{52}\sublabel{NWNVxch-1cAtyV-4}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-4}}}\moddef{Example Session~{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1cAtyV-3}{NWNVxch-1cAtyV-5}\nwenddeflinemarkup
> (\nwlinkedidentc{objects-at}{NWNVxch-1p0Y9w-6} 'living-room \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})
(WHISKEY BUCKET)
\nwidentuses{\\{{\nwixident{*object-locations*}}{*object-locations*}}\\{{\nwixident{*objects*}}{*objects*}}\\{{\nwixident{objects-at}}{objects-at}}}\nwindexuse{\nwixident{*object-locations*}}{*object-locations*}{NWNVxch-1cAtyV-4}\nwindexuse{\nwixident{*objects*}}{*objects*}{NWNVxch-1cAtyV-4}\nwindexuse{\nwixident{objects-at}}{objects-at}{NWNVxch-1cAtyV-4}\nwendcode{}\nwbegindocs{53}\nwdocspar


\section{Describing Visible Objects}

\begin{marginfigure}
\nwenddocs{}\nwbegincode{54}\sublabel{NWNVxch-1Udfoj-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1Udfoj-1}}}\moddef{describe-obj~{\nwtagstyle{}\subpageref{NWNVxch-1Udfoj-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-7}}\nwenddeflinemarkup
(describe-obj (obj)
  `(you see a ,obj on the floor.))
\nwused{\\{NWNVxch-1p0Y9w-7}}\nwendcode{}\nwbegindocs{55}\nwdocspar

\nwenddocs{}\nwbegincode{56}\sublabel{NWNVxch-2nwA8S-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2nwA8S-1}}}\moddef{Find the objects at the current location.~{\nwtagstyle{}\subpageref{NWNVxch-2nwA8S-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-7}}\nwenddeflinemarkup
(\nwlinkedidentc{objects-at}{NWNVxch-1p0Y9w-6} loc objs obj-loc)
\nwused{\\{NWNVxch-1p0Y9w-7}}\nwidentuses{\\{{\nwixident{objects-at}}{objects-at}}}\nwindexuse{\nwixident{objects-at}}{objects-at}{NWNVxch-2nwA8S-1}\nwendcode{}\nwbegindocs{57}\nwdocspar

\nwenddocs{}\nwbegincode{58}\sublabel{NWNVxch-2wzutV-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2wzutV-1}}}\moddef{Convert the objects to descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-2wzutV-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-7}}\nwenddeflinemarkup
mapcar #'describe-obj
\nwused{\\{NWNVxch-1p0Y9w-7}}\nwendcode{}\nwbegindocs{59}\nwdocspar
\end{marginfigure}

To describe the objects visible at a given location:
\begin{enumerate}
  \item {\Tt{}\LA{}Find the objects at the current location.~{\nwtagstyle{}\subpageref{NWNVxch-2nwA8S-1}}\RA{}\nwendquote}
  \item {\Tt{}\LA{}Convert the objects to descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-2wzutV-1}}\RA{}\nwendquote}
  \item {\Tt{}\LA{}Join the descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-2I51ok-1}}\RA{}\nwendquote}
\end{enumerate}

\nwenddocs{}\nwbegincode{60}\sublabel{NWNVxch-1p0Y9w-7}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-7}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-6}{NWNVxch-1p0Y9w-8}\nwenddeflinemarkup
(defun \nwlinkedidentc{describe-objects}{NWNVxch-1p0Y9w-7} (loc objs obj-loc)\nwindexdefn{\nwixident{describe-objects}}{describe-objects}{NWNVxch-1p0Y9w-7}
  (labels (\LA{}describe-obj~{\nwtagstyle{}\subpageref{NWNVxch-1Udfoj-1}}\RA{})
    (\LA{}Join the descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-2I51ok-1}}\RA{}
           (\LA{}Convert the objects to descriptions.~{\nwtagstyle{}\subpageref{NWNVxch-2wzutV-1}}\RA{}
                   \LA{}Find the objects at the current location.~{\nwtagstyle{}\subpageref{NWNVxch-2nwA8S-1}}\RA{}))))


\nwidentdefs{\\{{\nwixident{describe-objects}}{describe-objects}}}\nwendcode{}\nwbegindocs{61}\nwdocspar

\nwenddocs{}\nwbegincode{62}\sublabel{NWNVxch-1cAtyV-5}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-5}}}\moddef{Example Session~{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1cAtyV-4}{NWNVxch-1cAtyV-6}\nwenddeflinemarkup
> (\nwlinkedidentc{describe-objects}{NWNVxch-1p0Y9w-7} 'living-room \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})
(\LA{}living-room object descriptions~{\nwtagstyle{}\subpageref{NWNVxch-OvzM6-1}}\RA{})
\nwidentuses{\\{{\nwixident{*object-locations*}}{*object-locations*}}\\{{\nwixident{*objects*}}{*objects*}}\\{{\nwixident{describe-objects}}{describe-objects}}}\nwindexuse{\nwixident{*object-locations*}}{*object-locations*}{NWNVxch-1cAtyV-5}\nwindexuse{\nwixident{*objects*}}{*objects*}{NWNVxch-1cAtyV-5}\nwindexuse{\nwixident{describe-objects}}{describe-objects}{NWNVxch-1cAtyV-5}\nwendcode{}\nwbegindocs{63}\nwdocspar


\section{Describing It All}

\marginnote{%
  N.B. The {\Tt{}\nwlinkedidentq{look}{NWNVxch-1p0Y9w-8}\nwendquote} function is {\bf not} functional, since it reads global
  variables.
}

\begin{marginfigure}
\nwenddocs{}\nwbegincode{64}\sublabel{NWNVxch-tHqk1-4}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-tHqk1-4}}}\moddef{define the global variables~{\nwtagstyle{}\subpageref{NWNVxch-tHqk1-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-2}}\nwprevnextdefs{NWNVxch-tHqk1-3}{\relax}\nwenddeflinemarkup
(defparameter \nwlinkedidentc{*location*}{NWNVxch-tHqk1-4} 'living-room)\nwindexdefn{\nwixident{*location*}}{*location*}{NWNVxch-tHqk1-4}


\nwused{\\{NWNVxch-1p0Y9w-2}}\nwidentdefs{\\{{\nwixident{*location*}}{*location*}}}\nwendcode{}\nwbegindocs{65}\nwdocspar

\nwenddocs{}\nwbegincode{66}\sublabel{NWNVxch-1cAtyV-6}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-6}}}\moddef{Example Session~{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1cAtyV-5}{NWNVxch-1cAtyV-7}\nwenddeflinemarkup
> (\nwlinkedidentc{look}{NWNVxch-1p0Y9w-8})
(\LA{}living-room description~{\nwtagstyle{}\subpageref{NWNVxch-ozR14-1}}\RA{}
 \LA{}living-room path descriptions~{\nwtagstyle{}\subpageref{NWNVxch-1Thvud-1}}\RA{}
 \LA{}living-room object descriptions~{\nwtagstyle{}\subpageref{NWNVxch-OvzM6-1}}\RA{})
\nwidentuses{\\{{\nwixident{look}}{look}}}\nwindexuse{\nwixident{look}}{look}{NWNVxch-1cAtyV-6}\nwendcode{}\nwbegindocs{67}\nwdocspar
\end{marginfigure}

\nwenddocs{}\nwbegincode{68}\sublabel{NWNVxch-1p0Y9w-8}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-8}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-7}{NWNVxch-1p0Y9w-9}\nwenddeflinemarkup
(defun \nwlinkedidentc{look}{NWNVxch-1p0Y9w-8} ()\nwindexdefn{\nwixident{look}}{look}{NWNVxch-1p0Y9w-8}
  (append (\nwlinkedidentc{describe-location}{NWNVxch-1p0Y9w-3} \nwlinkedidentc{*location*}{NWNVxch-tHqk1-4} \nwlinkedidentc{*nodes*}{NWNVxch-tHqk1-1})
          (\nwlinkedidentc{describe-paths}{NWNVxch-1p0Y9w-5} \nwlinkedidentc{*location*}{NWNVxch-tHqk1-4} \nwlinkedidentc{*edges*}{NWNVxch-tHqk1-2})
          (\nwlinkedidentc{describe-objects}{NWNVxch-1p0Y9w-7} \nwlinkedidentc{*location*}{NWNVxch-tHqk1-4} \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})))


\nwidentdefs{\\{{\nwixident{look}}{look}}}\nwidentuses{\\{{\nwixident{*edges*}}{*edges*}}\\{{\nwixident{*location*}}{*location*}}\\{{\nwixident{*nodes*}}{*nodes*}}\\{{\nwixident{*object-locations*}}{*object-locations*}}\\{{\nwixident{*objects*}}{*objects*}}\\{{\nwixident{describe-location}}{describe-location}}\\{{\nwixident{describe-objects}}{describe-objects}}\\{{\nwixident{describe-paths}}{describe-paths}}}\nwindexuse{\nwixident{*edges*}}{*edges*}{NWNVxch-1p0Y9w-8}\nwindexuse{\nwixident{*location*}}{*location*}{NWNVxch-1p0Y9w-8}\nwindexuse{\nwixident{*nodes*}}{*nodes*}{NWNVxch-1p0Y9w-8}\nwindexuse{\nwixident{*object-locations*}}{*object-locations*}{NWNVxch-1p0Y9w-8}\nwindexuse{\nwixident{*objects*}}{*objects*}{NWNVxch-1p0Y9w-8}\nwindexuse{\nwixident{describe-location}}{describe-location}{NWNVxch-1p0Y9w-8}\nwindexuse{\nwixident{describe-objects}}{describe-objects}{NWNVxch-1p0Y9w-8}\nwindexuse{\nwixident{describe-paths}}{describe-paths}{NWNVxch-1p0Y9w-8}\nwendcode{}\nwbegindocs{69}\nwdocspar


\section{Walking Around in Our World}

Given a \lsp{direction},
{\Tt{}\LA{}locate the path marked with the appropriate direction~{\nwtagstyle{}\subpageref{NWNVxch-2l56no-1}}\RA{}\nwendquote} and
{\Tt{}\LA{}try to go in that direction~{\nwtagstyle{}\subpageref{NWNVxch-1WD8QL-1}}\RA{}\nwendquote}. Since the \lsp{direction} will be there,
{\Tt{}\LA{}match against the \code{}cadr\edoc{} of each path~{\nwtagstyle{}\subpageref{NWNVxch-3GxTYM-1}}\RA{}\nwendquote}.

\begin{marginfigure}
\nwenddocs{}\nwbegincode{70}\sublabel{NWNVxch-11Xqmc-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-11Xqmc-1}}}\moddef{look up the available walkings paths~{\nwtagstyle{}\subpageref{NWNVxch-11Xqmc-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-2l56no-1}}\nwenddeflinemarkup
(cdr (assoc \nwlinkedidentc{*location*}{NWNVxch-tHqk1-4} \nwlinkedidentc{*edges*}{NWNVxch-tHqk1-2}))
\nwused{\\{NWNVxch-2l56no-1}}\nwidentuses{\\{{\nwixident{*edges*}}{*edges*}}\\{{\nwixident{*location*}}{*location*}}}\nwindexuse{\nwixident{*edges*}}{*edges*}{NWNVxch-11Xqmc-1}\nwindexuse{\nwixident{*location*}}{*location*}{NWNVxch-11Xqmc-1}\nwendcode{}\nwbegindocs{71}\nwdocspar

\nwenddocs{}\nwbegincode{72}\sublabel{NWNVxch-3GxTYM-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-3GxTYM-1}}}\moddef{match against the \code{}cadr\edoc{} of each path~{\nwtagstyle{}\subpageref{NWNVxch-3GxTYM-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-2l56no-1}}\nwenddeflinemarkup
:key #'cadr
\nwused{\\{NWNVxch-2l56no-1}}\nwendcode{}\nwbegindocs{73}\nwdocspar
\end{marginfigure}

\nwenddocs{}\nwbegincode{74}\sublabel{NWNVxch-2l56no-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2l56no-1}}}\moddef{locate the path marked with the appropriate direction~{\nwtagstyle{}\subpageref{NWNVxch-2l56no-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-9}}\nwenddeflinemarkup
(find direction
      \LA{}look up the available walkings paths~{\nwtagstyle{}\subpageref{NWNVxch-11Xqmc-1}}\RA{}
      \LA{}match against the \code{}cadr\edoc{} of each path~{\nwtagstyle{}\subpageref{NWNVxch-3GxTYM-1}}\RA{})
\nwused{\\{NWNVxch-1p0Y9w-9}}\nwendcode{}\nwbegindocs{75}\nwdocspar

If such a path is found, {\Tt{}\LA{}adjust the player's position~{\nwtagstyle{}\subpageref{NWNVxch-33W0lF-1}}\RA{}\nwendquote},
otherwise {\Tt{}\LA{}admonish the player~{\nwtagstyle{}\subpageref{NWNVxch-13z0z-1}}\RA{}\nwendquote}.

\nwenddocs{}\nwbegincode{76}\sublabel{NWNVxch-1WD8QL-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1WD8QL-1}}}\moddef{try to go in that direction~{\nwtagstyle{}\subpageref{NWNVxch-1WD8QL-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-9}}\nwenddeflinemarkup
(if next
    (progn \LA{}adjust the player's position~{\nwtagstyle{}\subpageref{NWNVxch-33W0lF-1}}\RA{}
           (\nwlinkedidentc{look}{NWNVxch-1p0Y9w-8}))
    \LA{}admonish the player~{\nwtagstyle{}\subpageref{NWNVxch-13z0z-1}}\RA{})
\nwused{\\{NWNVxch-1p0Y9w-9}}\nwidentuses{\\{{\nwixident{look}}{look}}}\nwindexuse{\nwixident{look}}{look}{NWNVxch-1WD8QL-1}\nwendcode{}\nwbegindocs{77}\nwdocspar

\begin{marginfigure}
\nwenddocs{}\nwbegincode{78}\sublabel{NWNVxch-33W0lF-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-33W0lF-1}}}\moddef{adjust the player's position~{\nwtagstyle{}\subpageref{NWNVxch-33W0lF-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1WD8QL-1}}\nwenddeflinemarkup
(setf \nwlinkedidentc{*location*}{NWNVxch-tHqk1-4} (car next))
\nwused{\\{NWNVxch-1WD8QL-1}}\nwidentuses{\\{{\nwixident{*location*}}{*location*}}}\nwindexuse{\nwixident{*location*}}{*location*}{NWNVxch-33W0lF-1}\nwendcode{}\nwbegindocs{79}\nwdocspar

\nwenddocs{}\nwbegincode{80}\sublabel{NWNVxch-13z0z-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-13z0z-1}}}\moddef{admonish the player~{\nwtagstyle{}\subpageref{NWNVxch-13z0z-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1WD8QL-1}\\{NWNVxch-3XNgJW-1}}\nwenddeflinemarkup
'(you cannot go that way.)
\nwused{\\{NWNVxch-1WD8QL-1}\\{NWNVxch-3XNgJW-1}}\nwendcode{}\nwbegindocs{81}\nwdocspar
\end{marginfigure}

\nwenddocs{}\nwbegincode{82}\sublabel{NWNVxch-1p0Y9w-9}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-9}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-8}{NWNVxch-1p0Y9w-A}\nwenddeflinemarkup
(defun \nwlinkedidentc{walk}{NWNVxch-1p0Y9w-9} (direction)\nwindexdefn{\nwixident{walk}}{walk}{NWNVxch-1p0Y9w-9}
  (let ((next \LA{}locate the path marked with the appropriate direction~{\nwtagstyle{}\subpageref{NWNVxch-2l56no-1}}\RA{}))
    \LA{}try to go in that direction~{\nwtagstyle{}\subpageref{NWNVxch-1WD8QL-1}}\RA{}))


\nwidentdefs{\\{{\nwixident{walk}}{walk}}}\nwendcode{}\nwbegindocs{83}\nwdocspar


% \newpage
\section{Picking Up Objects}

\begin{marginfigure}
\nwenddocs{}\nwbegincode{84}\sublabel{NWNVxch-ZgAXP-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-ZgAXP-1}}}\moddef{the object is on the floor~{\nwtagstyle{}\subpageref{NWNVxch-ZgAXP-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-A}}\nwenddeflinemarkup
(member object \LA{}get the list of objects here~{\nwtagstyle{}\subpageref{NWNVxch-23VgYu-1}}\RA{})
\nwused{\\{NWNVxch-1p0Y9w-A}}\nwendcode{}\nwbegindocs{85}\nwdocspar

\nwenddocs{}\nwbegincode{86}\sublabel{NWNVxch-4LBe3S-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-4LBe3S-1}}}\moddef{pick it up~{\nwtagstyle{}\subpageref{NWNVxch-4LBe3S-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-A}}\nwenddeflinemarkup
(push (list object 'body) \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})
`(you are now carrying the ,object)
\nwused{\\{NWNVxch-1p0Y9w-A}}\nwidentuses{\\{{\nwixident{*object-locations*}}{*object-locations*}}}\nwindexuse{\nwixident{*object-locations*}}{*object-locations*}{NWNVxch-4LBe3S-1}\nwendcode{}\nwbegindocs{87}\nwdocspar
\end{marginfigure}

If {\Tt{}\LA{}the object is on the floor~{\nwtagstyle{}\subpageref{NWNVxch-ZgAXP-1}}\RA{}\nwendquote}, {\Tt{}\LA{}pick it up~{\nwtagstyle{}\subpageref{NWNVxch-4LBe3S-1}}\RA{}\nwendquote}.

\nwenddocs{}\nwbegincode{88}\sublabel{NWNVxch-23VgYu-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-23VgYu-1}}}\moddef{get the list of objects here~{\nwtagstyle{}\subpageref{NWNVxch-23VgYu-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-ZgAXP-1}}\nwenddeflinemarkup
(\nwlinkedidentc{objects-at}{NWNVxch-1p0Y9w-6} \nwlinkedidentc{*location*}{NWNVxch-tHqk1-4} \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})
\nwused{\\{NWNVxch-ZgAXP-1}}\nwidentuses{\\{{\nwixident{*location*}}{*location*}}\\{{\nwixident{*object-locations*}}{*object-locations*}}\\{{\nwixident{*objects*}}{*objects*}}\\{{\nwixident{objects-at}}{objects-at}}}\nwindexuse{\nwixident{*location*}}{*location*}{NWNVxch-23VgYu-1}\nwindexuse{\nwixident{*object-locations*}}{*object-locations*}{NWNVxch-23VgYu-1}\nwindexuse{\nwixident{*objects*}}{*objects*}{NWNVxch-23VgYu-1}\nwindexuse{\nwixident{objects-at}}{objects-at}{NWNVxch-23VgYu-1}\nwendcode{}\nwbegindocs{89}\nwdocspar

\nwenddocs{}\nwbegincode{90}\sublabel{NWNVxch-1p0Y9w-A}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-A}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-9}{NWNVxch-1p0Y9w-B}\nwenddeflinemarkup
(defun \nwlinkedidentc{pickup}{NWNVxch-1p0Y9w-A} (object)\nwindexdefn{\nwixident{pickup}}{pickup}{NWNVxch-1p0Y9w-A}
  (if \LA{}the object is on the floor~{\nwtagstyle{}\subpageref{NWNVxch-ZgAXP-1}}\RA{}
      (progn \LA{}pick it up~{\nwtagstyle{}\subpageref{NWNVxch-4LBe3S-1}}\RA{})
      '(you cannot get that.)))


\nwidentdefs{\\{{\nwixident{pickup}}{pickup}}}\nwendcode{}\nwbegindocs{91}\nwdocspar

\nwenddocs{}\nwbegincode{92}\sublabel{NWNVxch-1cAtyV-7}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-7}}}\moddef{Example Session~{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1cAtyV-6}{NWNVxch-1cAtyV-8}\nwenddeflinemarkup
> (\nwlinkedidentc{pickup}{NWNVxch-1p0Y9w-A} 'whiskey)
(YOU ARE NOW CARRYING THE WHISKEY)
\nwidentuses{\\{{\nwixident{pickup}}{pickup}}}\nwindexuse{\nwixident{pickup}}{pickup}{NWNVxch-1cAtyV-7}\nwendcode{}\nwbegindocs{93}\nwdocspar


\section{Checking Our Inventory}

\begin{marginfigure}
\nwenddocs{}\nwbegincode{94}\sublabel{NWNVxch-2OUSai-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2OUSai-1}}}\moddef{retrieve the list of carried objects~{\nwtagstyle{}\subpageref{NWNVxch-2OUSai-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1p0Y9w-B}}\nwenddeflinemarkup
(\nwlinkedidentc{objects-at}{NWNVxch-1p0Y9w-6} 'body \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})
\nwused{\\{NWNVxch-1p0Y9w-B}}\nwidentuses{\\{{\nwixident{*object-locations*}}{*object-locations*}}\\{{\nwixident{*objects*}}{*objects*}}\\{{\nwixident{objects-at}}{objects-at}}}\nwindexuse{\nwixident{*object-locations*}}{*object-locations*}{NWNVxch-2OUSai-1}\nwindexuse{\nwixident{*objects*}}{*objects*}{NWNVxch-2OUSai-1}\nwindexuse{\nwixident{objects-at}}{objects-at}{NWNVxch-2OUSai-1}\nwendcode{}\nwbegindocs{95}\nwdocspar

\nwenddocs{}\nwbegincode{96}\sublabel{NWNVxch-1cAtyV-8}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-8}}}\moddef{Example Session~{\nwtagstyle{}\subpageref{NWNVxch-1cAtyV-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1cAtyV-7}{\relax}\nwenddeflinemarkup
> (\nwlinkedidentc{inventory}{NWNVxch-1p0Y9w-B})
\LA{}All you have is whiskey.~{\nwtagstyle{}\subpageref{NWNVxch-1guz87-1}}\RA{}
\nwidentuses{\\{{\nwixident{inventory}}{inventory}}}\nwindexuse{\nwixident{inventory}}{inventory}{NWNVxch-1cAtyV-8}\nwendcode{}\nwbegindocs{97}\nwdocspar
\end{marginfigure}

\nwenddocs{}\nwbegincode{98}\sublabel{NWNVxch-1p0Y9w-B}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-B}}}\moddef{*~{\nwtagstyle{}\subpageref{NWNVxch-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWNVxch-1p0Y9w-A}{\relax}\nwenddeflinemarkup
(defun \nwlinkedidentc{inventory}{NWNVxch-1p0Y9w-B} ()\nwindexdefn{\nwixident{inventory}}{inventory}{NWNVxch-1p0Y9w-B}
  (cons 'items- \LA{}retrieve the list of carried objects~{\nwtagstyle{}\subpageref{NWNVxch-2OUSai-1}}\RA{}))


\nwidentdefs{\\{{\nwixident{inventory}}{inventory}}}\nwendcode{}\nwbegindocs{99}\nwdocspar


\section{Tests}

\begin{marginfigure}
\nwenddocs{}\nwbegincode{100}\sublabel{NWNVxch-1Thvud-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1Thvud-1}}}\moddef{living-room path descriptions~{\nwtagstyle{}\subpageref{NWNVxch-1Thvud-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1cAtyV-6}\\{NWNVxch-386mef-1}\\{NWNVxch-3XNgJW-1}}\nwenddeflinemarkup
\LA{}garden door~{\nwtagstyle{}\subpageref{NWNVxch-vCtwU-1}}\RA{}
\LA{}attic ladder~{\nwtagstyle{}\subpageref{NWNVxch-1nNOhz-1}}\RA{}
\nwused{\\{NWNVxch-1cAtyV-6}\\{NWNVxch-386mef-1}\\{NWNVxch-3XNgJW-1}}\nwendcode{}\nwbegindocs{101}\nwdocspar

\nwenddocs{}\nwbegincode{102}\sublabel{NWNVxch-OvzM6-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-OvzM6-1}}}\moddef{living-room object descriptions~{\nwtagstyle{}\subpageref{NWNVxch-OvzM6-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1cAtyV-5}\\{NWNVxch-1cAtyV-6}\\{NWNVxch-386mef-1}\\{NWNVxch-3XNgJW-1}}\nwenddeflinemarkup
YOU SEE A WHISKEY ON THE FLOOR.
YOU SEE A BUCKET ON THE FLOOR.
\nwused{\\{NWNVxch-1cAtyV-5}\\{NWNVxch-1cAtyV-6}\\{NWNVxch-386mef-1}\\{NWNVxch-3XNgJW-1}}\nwendcode{}\nwbegindocs{103}\nwdocspar

\nwenddocs{}\nwbegincode{104}\sublabel{NWNVxch-2aavu-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2aavu-1}}}\moddef{garden path description~{\nwtagstyle{}\subpageref{NWNVxch-2aavu-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3XNgJW-1}}\nwenddeflinemarkup
THERE IS A DOOR GOING EAST FROM HERE.
\nwused{\\{NWNVxch-3XNgJW-1}}\nwendcode{}\nwbegindocs{105}\nwdocspar

\nwenddocs{}\nwbegincode{106}\sublabel{NWNVxch-2DpHWR-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2DpHWR-1}}}\moddef{garden object descriptions~{\nwtagstyle{}\subpageref{NWNVxch-2DpHWR-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3XNgJW-1}}\nwenddeflinemarkup
YOU SEE A FROG ON THE FLOOR.
YOU SEE A CHAIN ON THE FLOOR.
\nwused{\\{NWNVxch-3XNgJW-1}}\nwendcode{}\nwbegindocs{107}\nwdocspar

\nwenddocs{}\nwbegincode{108}\sublabel{NWNVxch-4E6M4z-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-4E6M4z-1}}}\moddef{You've got whiskey!~{\nwtagstyle{}\subpageref{NWNVxch-4E6M4z-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3XNgJW-1}}\nwenddeflinemarkup
'(YOU ARE NOW CARRYING THE WHISKEY)
\nwused{\\{NWNVxch-3XNgJW-1}}\nwendcode{}\nwbegindocs{109}\nwdocspar

\nwenddocs{}\nwbegincode{110}\sublabel{NWNVxch-1guz87-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-1guz87-1}}}\moddef{All you have is whiskey.~{\nwtagstyle{}\subpageref{NWNVxch-1guz87-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-1cAtyV-8}\\{NWNVxch-3XNgJW-1}}\nwenddeflinemarkup
'(ITEMS- WHISKEY)
\nwused{\\{NWNVxch-1cAtyV-8}\\{NWNVxch-3XNgJW-1}}\nwendcode{}\nwbegindocs{111}\nwdocspar
\end{marginfigure}

\nwenddocs{}\nwbegincode{112}\sublabel{NWNVxch-2hXnLe-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2hXnLe-1}}}\moddef{test/wizard5.lisp~{\nwtagstyle{}\subpageref{NWNVxch-2hXnLe-1}}}\endmoddef\nwstartdeflinemarkup\nwenddeflinemarkup
(in-package :\nwlinkedidentc{lol.wizard5}{NWNVxch-1p0Y9w-1})


(prove:plan 2)


\LA{}Test the private functions in \code{}lol.wizard5\edoc{}~{\nwtagstyle{}\subpageref{NWNVxch-386mef-1}}\RA{}


\LA{}Test the exported functions in \code{}lol.wizard5\edoc{}.~{\nwtagstyle{}\subpageref{NWNVxch-3XNgJW-1}}\RA{}


(prove:finalize)
\nwnotused{test/wizard5.lisp}\nwidentuses{\\{{\nwixident{lol.wizard5}}{lol.wizard5}}}\nwindexuse{\nwixident{lol.wizard5}}{lol.wizard5}{NWNVxch-2hXnLe-1}\nwendcode{}\nwbegindocs{113}\nwdocspar


\subsection{\lsp{lol.wizard5} (Private Parts)}

\nwenddocs{}\nwbegincode{114}\sublabel{NWNVxch-386mef-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-386mef-1}}}\moddef{Test the private functions in \code{}lol.wizard5\edoc{}~{\nwtagstyle{}\subpageref{NWNVxch-386mef-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-2hXnLe-1}}\nwenddeflinemarkup
(prove:subtest "\nwlinkedidentc{lol.wizard5}{NWNVxch-1p0Y9w-1} (Private Parts)"
  (prove:is (\nwlinkedidentc{describe-location}{NWNVxch-1p0Y9w-3} 'living-room \nwlinkedidentc{*nodes*}{NWNVxch-tHqk1-1})
            '(\LA{}living-room description~{\nwtagstyle{}\subpageref{NWNVxch-ozR14-1}}\RA{}))
  (prove:is (\nwlinkedidentc{describe-path}{NWNVxch-1p0Y9w-4} '(garden west door))
            '(\LA{}garden door~{\nwtagstyle{}\subpageref{NWNVxch-vCtwU-1}}\RA{}))
  (prove:is (\nwlinkedidentc{describe-paths}{NWNVxch-1p0Y9w-5} 'living-room \nwlinkedidentc{*edges*}{NWNVxch-tHqk1-2})
            '(\LA{}living-room path descriptions~{\nwtagstyle{}\subpageref{NWNVxch-1Thvud-1}}\RA{}))
  (prove:is (\nwlinkedidentc{describe-objects}{NWNVxch-1p0Y9w-7} 'living-room \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})
            '(\LA{}living-room object descriptions~{\nwtagstyle{}\subpageref{NWNVxch-OvzM6-1}}\RA{}))
  (prove:is (\nwlinkedidentc{objects-at}{NWNVxch-1p0Y9w-6} 'living-room \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})
            '(WHISKEY BUCKET)))


\nwused{\\{NWNVxch-2hXnLe-1}}\nwidentuses{\\{{\nwixident{*edges*}}{*edges*}}\\{{\nwixident{*nodes*}}{*nodes*}}\\{{\nwixident{*object-locations*}}{*object-locations*}}\\{{\nwixident{*objects*}}{*objects*}}\\{{\nwixident{describe-location}}{describe-location}}\\{{\nwixident{describe-objects}}{describe-objects}}\\{{\nwixident{describe-path}}{describe-path}}\\{{\nwixident{describe-paths}}{describe-paths}}\\{{\nwixident{lol.wizard5}}{lol.wizard5}}\\{{\nwixident{objects-at}}{objects-at}}}\nwindexuse{\nwixident{*edges*}}{*edges*}{NWNVxch-386mef-1}\nwindexuse{\nwixident{*nodes*}}{*nodes*}{NWNVxch-386mef-1}\nwindexuse{\nwixident{*object-locations*}}{*object-locations*}{NWNVxch-386mef-1}\nwindexuse{\nwixident{*objects*}}{*objects*}{NWNVxch-386mef-1}\nwindexuse{\nwixident{describe-location}}{describe-location}{NWNVxch-386mef-1}\nwindexuse{\nwixident{describe-objects}}{describe-objects}{NWNVxch-386mef-1}\nwindexuse{\nwixident{describe-path}}{describe-path}{NWNVxch-386mef-1}\nwindexuse{\nwixident{describe-paths}}{describe-paths}{NWNVxch-386mef-1}\nwindexuse{\nwixident{lol.wizard5}}{lol.wizard5}{NWNVxch-386mef-1}\nwindexuse{\nwixident{objects-at}}{objects-at}{NWNVxch-386mef-1}\nwendcode{}\nwbegindocs{115}\nwdocspar


\subsection{\lsp{lol.wizard5} (Public API)}
\nwenddocs{}\nwbegincode{116}\sublabel{NWNVxch-3XNgJW-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-3XNgJW-1}}}\moddef{Test the exported functions in \code{}lol.wizard5\edoc{}.~{\nwtagstyle{}\subpageref{NWNVxch-3XNgJW-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-2hXnLe-1}}\nwenddeflinemarkup
(prove:subtest "\nwlinkedidentc{lol.wizard5}{NWNVxch-1p0Y9w-1} (Public API)"
  (prove:is (\nwlinkedidentc{look}{NWNVxch-1p0Y9w-8})
            '(\LA{}living-room description~{\nwtagstyle{}\subpageref{NWNVxch-ozR14-1}}\RA{}
              \LA{}living-room path descriptions~{\nwtagstyle{}\subpageref{NWNVxch-1Thvud-1}}\RA{}
              \LA{}living-room object descriptions~{\nwtagstyle{}\subpageref{NWNVxch-OvzM6-1}}\RA{}))
  (prove:subtest "Pick up the whiskey"
    (prove:is (\nwlinkedidentc{pickup}{NWNVxch-1p0Y9w-A} 'whiskey)
              \LA{}You've got whiskey!~{\nwtagstyle{}\subpageref{NWNVxch-4E6M4z-1}}\RA{})
    (prove:is (\nwlinkedidentc{objects-at}{NWNVxch-1p0Y9w-6} 'living-room \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})
              '(BUCKET))
    (prove:is (\nwlinkedidentc{describe-objects}{NWNVxch-1p0Y9w-7} 'living-room \nwlinkedidentc{*objects*}{NWNVxch-tHqk1-3} \nwlinkedidentc{*object-locations*}{NWNVxch-tHqk1-3})
              '(YOU SEE A BUCKET ON THE FLOOR.)))
  (prove:is (\nwlinkedidentc{pickup}{NWNVxch-1p0Y9w-A} 'the-pace)
            '(you cannot get that.))
  (prove:is (\nwlinkedidentc{walk}{NWNVxch-1p0Y9w-9} 'west)
            '(\LA{}garden description~{\nwtagstyle{}\subpageref{NWNVxch-4E8Y49-1}}\RA{}
              \LA{}garden path description~{\nwtagstyle{}\subpageref{NWNVxch-2aavu-1}}\RA{}
              \LA{}garden object descriptions~{\nwtagstyle{}\subpageref{NWNVxch-2DpHWR-1}}\RA{}))
  (prove:is (\nwlinkedidentc{walk}{NWNVxch-1p0Y9w-9} 'south)
            \LA{}admonish the player~{\nwtagstyle{}\subpageref{NWNVxch-13z0z-1}}\RA{})
  (prove:is (\nwlinkedidentc{inventory}{NWNVxch-1p0Y9w-B})
            \LA{}All you have is whiskey.~{\nwtagstyle{}\subpageref{NWNVxch-1guz87-1}}\RA{}))


\nwused{\\{NWNVxch-2hXnLe-1}}\nwidentuses{\\{{\nwixident{*object-locations*}}{*object-locations*}}\\{{\nwixident{*objects*}}{*objects*}}\\{{\nwixident{describe-objects}}{describe-objects}}\\{{\nwixident{inventory}}{inventory}}\\{{\nwixident{lol.wizard5}}{lol.wizard5}}\\{{\nwixident{look}}{look}}\\{{\nwixident{objects-at}}{objects-at}}\\{{\nwixident{pickup}}{pickup}}\\{{\nwixident{walk}}{walk}}}\nwindexuse{\nwixident{*object-locations*}}{*object-locations*}{NWNVxch-3XNgJW-1}\nwindexuse{\nwixident{*objects*}}{*objects*}{NWNVxch-3XNgJW-1}\nwindexuse{\nwixident{describe-objects}}{describe-objects}{NWNVxch-3XNgJW-1}\nwindexuse{\nwixident{inventory}}{inventory}{NWNVxch-3XNgJW-1}\nwindexuse{\nwixident{lol.wizard5}}{lol.wizard5}{NWNVxch-3XNgJW-1}\nwindexuse{\nwixident{look}}{look}{NWNVxch-3XNgJW-1}\nwindexuse{\nwixident{objects-at}}{objects-at}{NWNVxch-3XNgJW-1}\nwindexuse{\nwixident{pickup}}{pickup}{NWNVxch-3XNgJW-1}\nwindexuse{\nwixident{walk}}{walk}{NWNVxch-3XNgJW-1}\nwendcode{}\nwbegindocs{117}\nwdocspar


\newpage
\section{Running the Tests}

\nwenddocs{}\nwbegincode{118}\sublabel{NWNVxch-IN2nV-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-IN2nV-1}}}\moddef{Set the exit status.~{\nwtagstyle{}\subpageref{NWNVxch-IN2nV-1}}}\endmoddef\nwstartdeflinemarkup\nwenddeflinemarkup
(if (null failures) 0 1)
\nwnotused{Set the exit status.}\nwendcode{}\nwbegindocs{119}\nwdocspar

\nwenddocs{}\nwbegincode{120}\sublabel{NWNVxch-4556X7-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-4556X7-1}}}\moddef{Exit with an appropriate status code.~{\nwtagstyle{}\subpageref{NWNVxch-4556X7-1}}}\endmoddef\nwstartdeflinemarkup\nwenddeflinemarkup
(sb-posix:exit status)
\nwnotused{Exit with an appropriate status code.}\nwendcode{}\nwbegindocs{121}\nwdocspar
\end{marginfigure}


\todo[inline]{Describe {\Tt{}prove\nwendquote}}
\nwenddocs{}\nwbegincode{122}\sublabel{NWNVxch-2IS8oX-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-2IS8oX-1}}}\moddef{Run the system tests.~{\nwtagstyle{}\subpageref{NWNVxch-2IS8oX-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3OgzqG-1}}\nwenddeflinemarkup
(prove:run-test-system :lol-test)
\nwused{\\{NWNVxch-3OgzqG-1}}\nwendcode{}\nwbegindocs{123}\nwdocspar

\nwenddocs{}\nwbegincode{124}\sublabel{NWNVxch-3OgzqG-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-3OgzqG-1}}}\moddef{Run the system tests and exit.~{\nwtagstyle{}\subpageref{NWNVxch-3OgzqG-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3QIFQJ-1}}\nwenddeflinemarkup
(uiop:quit (if \LA{}Run the system tests.~{\nwtagstyle{}\subpageref{NWNVxch-2IS8oX-1}}\RA{} 0 1))
\nwused{\\{NWNVxch-3QIFQJ-1}}\nwendcode{}\nwbegindocs{125}\nwdocspar

% \subsection{Script}

\todo[inline]{Describe nix-shell shebang}
\nwenddocs{}\nwbegincode{126}\sublabel{NWNVxch-40XvAF-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-40XvAF-1}}}\moddef{script header~{\nwtagstyle{}\subpageref{NWNVxch-40XvAF-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3QIFQJ-1}}\nwprevnextdefs{\relax}{NWNVxch-40XvAF-2}\nwenddeflinemarkup
#! /usr/bin/env nix-shell
#! nix-shell -i sh -p sbcl


\nwalsodefined{\\{NWNVxch-40XvAF-2}\\{NWNVxch-40XvAF-3}}\nwused{\\{NWNVxch-3QIFQJ-1}}\nwendcode{}\nwbegindocs{127}\nwdocspar

\begin{marginfigure}
  Run \mintinline{bash}{sbcl} quietly:
\nwenddocs{}\nwbegincode{128}\sublabel{NWNVxch-40XvAF-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-40XvAF-2}}}\moddef{script header~{\nwtagstyle{}\subpageref{NWNVxch-40XvAF-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3QIFQJ-1}}\nwprevnextdefs{NWNVxch-40XvAF-1}{NWNVxch-40XvAF-3}\nwenddeflinemarkup
sbcl --noinform --non-interactive \\
\nwused{\\{NWNVxch-3QIFQJ-1}}\nwendcode{}\nwbegindocs{129}\nwdocspar

Load {\Tt{}\LA{}init.lisp~{\nwtagstyle{}\subpageref{nw@notdef}}\RA{}\nwendquote} as the user initialization file:
\nwenddocs{}\nwbegincode{130}\sublabel{NWNVxch-40XvAF-3}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-40XvAF-3}}}\moddef{script header~{\nwtagstyle{}\subpageref{NWNVxch-40XvAF-1}}}\plusendmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3QIFQJ-1}}\nwprevnextdefs{NWNVxch-40XvAF-2}{\relax}\nwenddeflinemarkup
     --userinit init.lisp \\
\nwused{\\{NWNVxch-3QIFQJ-1}}\nwendcode{}\nwbegindocs{131}\nwdocspar

\nwenddocs{}\nwbegincode{132}\sublabel{NWNVxch-4EavdC-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-4EavdC-1}}}\moddef{script footer~{\nwtagstyle{}\subpageref{NWNVxch-4EavdC-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3QIFQJ-1}}\nwenddeflinemarkup
# Local Variables:
# mode: sh
# End:
\nwused{\\{NWNVxch-3QIFQJ-1}}\nwendcode{}\nwbegindocs{133}\nwdocspar

\nwenddocs{}\nwbegincode{134}\sublabel{NWNVxch-tDAnM-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-tDAnM-1}}}\moddef{Load the test package.~{\nwtagstyle{}\subpageref{NWNVxch-tDAnM-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWNVxch-3QIFQJ-1}}\nwenddeflinemarkup
(asdf:load-system :lol-test)
\nwused{\\{NWNVxch-3QIFQJ-1}}\nwendcode{}\nwbegindocs{135}\nwdocspar
\end{marginfigure}

\nwenddocs{}\nwbegincode{136}\sublabel{NWNVxch-3QIFQJ-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWNVxch-3QIFQJ-1}}}\moddef{bin/runtests~{\nwtagstyle{}\subpageref{NWNVxch-3QIFQJ-1}}}\endmoddef\nwstartdeflinemarkup\nwenddeflinemarkup
\LA{}script header~{\nwtagstyle{}\subpageref{NWNVxch-40XvAF-1}}\RA{}
     --eval "\LA{}Load the test package.~{\nwtagstyle{}\subpageref{NWNVxch-tDAnM-1}}\RA{}" \\
     --eval "\LA{}Run the system tests and exit.~{\nwtagstyle{}\subpageref{NWNVxch-3OgzqG-1}}\RA{}"


\LA{}script footer~{\nwtagstyle{}\subpageref{NWNVxch-4EavdC-1}}\RA{}
\nwnotused{bin/runtests}\nwendcode{}

\nwixlogsorted{c}{{*}{NWNVxch-1p0Y9w-1}{\nwixd{NWNVxch-1p0Y9w-1}\nwixd{NWNVxch-1p0Y9w-2}\nwixd{NWNVxch-1p0Y9w-3}\nwixd{NWNVxch-1p0Y9w-4}\nwixd{NWNVxch-1p0Y9w-5}\nwixd{NWNVxch-1p0Y9w-6}\nwixd{NWNVxch-1p0Y9w-7}\nwixd{NWNVxch-1p0Y9w-8}\nwixd{NWNVxch-1p0Y9w-9}\nwixd{NWNVxch-1p0Y9w-A}\nwixd{NWNVxch-1p0Y9w-B}}}%
\nwixlogsorted{c}{{adjust the player's position}{NWNVxch-33W0lF-1}{\nwixu{NWNVxch-1WD8QL-1}\nwixd{NWNVxch-33W0lF-1}}}%
\nwixlogsorted{c}{{admonish the player}{NWNVxch-13z0z-1}{\nwixu{NWNVxch-1WD8QL-1}\nwixd{NWNVxch-13z0z-1}\nwixu{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{c}{{All you have is whiskey.}{NWNVxch-1guz87-1}{\nwixu{NWNVxch-1cAtyV-8}\nwixd{NWNVxch-1guz87-1}\nwixu{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{c}{{at-loc-p}{NWNVxch-4AIHSa-1}{\nwixd{NWNVxch-4AIHSa-1}\nwixu{NWNVxch-1p0Y9w-6}}}%
\nwixlogsorted{c}{{attic description}{NWNVxch-2w0KS8-1}{\nwixd{NWNVxch-2w0KS8-1}\nwixu{NWNVxch-tHqk1-1}}}%
\nwixlogsorted{c}{{attic ladder}{NWNVxch-1nNOhz-1}{\nwixd{NWNVxch-1nNOhz-1}\nwixu{NWNVxch-1cAtyV-3}\nwixu{NWNVxch-1Thvud-1}}}%
\nwixlogsorted{c}{{attic path}{NWNVxch-2ZorP9-1}{\nwixd{NWNVxch-2ZorP9-1}\nwixu{NWNVxch-tHqk1-2}}}%
\nwixlogsorted{c}{{bin/runtests}{NWNVxch-3QIFQJ-1}{\nwixd{NWNVxch-3QIFQJ-1}}}%
\nwixlogsorted{c}{{Convert the edges to descriptions.}{NWNVxch-3UGKyl-1}{\nwixd{NWNVxch-3UGKyl-1}\nwixu{NWNVxch-1p0Y9w-5}}}%
\nwixlogsorted{c}{{Convert the objects to descriptions.}{NWNVxch-2wzutV-1}{\nwixd{NWNVxch-2wzutV-1}\nwixu{NWNVxch-1p0Y9w-7}}}%
\nwixlogsorted{c}{{define the global variables}{NWNVxch-tHqk1-1}{\nwixu{NWNVxch-1p0Y9w-2}\nwixd{NWNVxch-tHqk1-1}\nwixd{NWNVxch-tHqk1-2}\nwixd{NWNVxch-tHqk1-3}\nwixd{NWNVxch-tHqk1-4}}}%
\nwixlogsorted{c}{{describe-obj}{NWNVxch-1Udfoj-1}{\nwixd{NWNVxch-1Udfoj-1}\nwixu{NWNVxch-1p0Y9w-7}}}%
\nwixlogsorted{c}{{Example Session}{NWNVxch-1cAtyV-1}{\nwixd{NWNVxch-1cAtyV-1}\nwixd{NWNVxch-1cAtyV-2}\nwixd{NWNVxch-1cAtyV-3}\nwixd{NWNVxch-1cAtyV-4}\nwixd{NWNVxch-1cAtyV-5}\nwixd{NWNVxch-1cAtyV-6}\nwixd{NWNVxch-1cAtyV-7}\nwixd{NWNVxch-1cAtyV-8}}}%
\nwixlogsorted{c}{{Exit with an appropriate status code.}{NWNVxch-4556X7-1}{\nwixd{NWNVxch-4556X7-1}}}%
\nwixlogsorted{c}{{Find the objects at the current location.}{NWNVxch-2nwA8S-1}{\nwixd{NWNVxch-2nwA8S-1}\nwixu{NWNVxch-1p0Y9w-7}}}%
\nwixlogsorted{c}{{Find the relevant edges.}{NWNVxch-2uLI1w-1}{\nwixd{NWNVxch-2uLI1w-1}\nwixu{NWNVxch-1p0Y9w-5}}}%
\nwixlogsorted{c}{{garden description}{NWNVxch-4E8Y49-1}{\nwixd{NWNVxch-4E8Y49-1}\nwixu{NWNVxch-tHqk1-1}\nwixu{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{c}{{garden door}{NWNVxch-vCtwU-1}{\nwixd{NWNVxch-vCtwU-1}\nwixu{NWNVxch-1cAtyV-2}\nwixu{NWNVxch-1cAtyV-3}\nwixu{NWNVxch-1Thvud-1}\nwixu{NWNVxch-386mef-1}}}%
\nwixlogsorted{c}{{garden object descriptions}{NWNVxch-2DpHWR-1}{\nwixd{NWNVxch-2DpHWR-1}\nwixu{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{c}{{garden path}{NWNVxch-1acezE-1}{\nwixd{NWNVxch-1acezE-1}\nwixu{NWNVxch-tHqk1-2}}}%
\nwixlogsorted{c}{{garden path description}{NWNVxch-2aavu-1}{\nwixd{NWNVxch-2aavu-1}\nwixu{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{c}{{get the list of objects here}{NWNVxch-23VgYu-1}{\nwixu{NWNVxch-ZgAXP-1}\nwixd{NWNVxch-23VgYu-1}}}%
\nwixlogsorted{c}{{Join the descriptions.}{NWNVxch-2I51ok-1}{\nwixd{NWNVxch-2I51ok-1}\nwixu{NWNVxch-1p0Y9w-5}\nwixu{NWNVxch-1p0Y9w-7}}}%
\nwixlogsorted{c}{{living-room description}{NWNVxch-ozR14-1}{\nwixd{NWNVxch-ozR14-1}\nwixu{NWNVxch-tHqk1-1}\nwixu{NWNVxch-1cAtyV-1}\nwixu{NWNVxch-1cAtyV-6}\nwixu{NWNVxch-386mef-1}\nwixu{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{c}{{living-room object descriptions}{NWNVxch-OvzM6-1}{\nwixu{NWNVxch-1cAtyV-5}\nwixu{NWNVxch-1cAtyV-6}\nwixd{NWNVxch-OvzM6-1}\nwixu{NWNVxch-386mef-1}\nwixu{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{c}{{living-room path descriptions}{NWNVxch-1Thvud-1}{\nwixu{NWNVxch-1cAtyV-6}\nwixd{NWNVxch-1Thvud-1}\nwixu{NWNVxch-386mef-1}\nwixu{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{c}{{living-room paths}{NWNVxch-2xf4OR-1}{\nwixd{NWNVxch-2xf4OR-1}\nwixu{NWNVxch-tHqk1-2}}}%
\nwixlogsorted{c}{{Load the test package.}{NWNVxch-tDAnM-1}{\nwixd{NWNVxch-tDAnM-1}\nwixu{NWNVxch-3QIFQJ-1}}}%
\nwixlogsorted{c}{{locate the path marked with the appropriate direction}{NWNVxch-2l56no-1}{\nwixd{NWNVxch-2l56no-1}\nwixu{NWNVxch-1p0Y9w-9}}}%
\nwixlogsorted{c}{{look up a location}{NWNVxch-3T3roy-1}{\nwixd{NWNVxch-3T3roy-1}\nwixu{NWNVxch-1p0Y9w-3}}}%
\nwixlogsorted{c}{{look up the available walkings paths}{NWNVxch-11Xqmc-1}{\nwixd{NWNVxch-11Xqmc-1}\nwixu{NWNVxch-2l56no-1}}}%
\nwixlogsorted{c}{{match against the \code{}cadr\edoc{} of each path}{NWNVxch-3GxTYM-1}{\nwixd{NWNVxch-3GxTYM-1}\nwixu{NWNVxch-2l56no-1}}}%
\nwixlogsorted{c}{{pick it up}{NWNVxch-4LBe3S-1}{\nwixd{NWNVxch-4LBe3S-1}\nwixu{NWNVxch-1p0Y9w-A}}}%
\nwixlogsorted{c}{{retrieve the list of carried objects}{NWNVxch-2OUSai-1}{\nwixd{NWNVxch-2OUSai-1}\nwixu{NWNVxch-1p0Y9w-B}}}%
\nwixlogsorted{c}{{Run the system tests and exit.}{NWNVxch-3OgzqG-1}{\nwixd{NWNVxch-3OgzqG-1}\nwixu{NWNVxch-3QIFQJ-1}}}%
\nwixlogsorted{c}{{Run the system tests.}{NWNVxch-2IS8oX-1}{\nwixd{NWNVxch-2IS8oX-1}\nwixu{NWNVxch-3OgzqG-1}}}%
\nwixlogsorted{c}{{script footer}{NWNVxch-4EavdC-1}{\nwixd{NWNVxch-4EavdC-1}\nwixu{NWNVxch-3QIFQJ-1}}}%
\nwixlogsorted{c}{{script header}{NWNVxch-40XvAF-1}{\nwixd{NWNVxch-40XvAF-1}\nwixd{NWNVxch-40XvAF-2}\nwixd{NWNVxch-40XvAF-3}\nwixu{NWNVxch-3QIFQJ-1}}}%
\nwixlogsorted{c}{{Set the exit status.}{NWNVxch-IN2nV-1}{\nwixd{NWNVxch-IN2nV-1}}}%
\nwixlogsorted{c}{{Test the exported functions in \code{}lol.wizard5\edoc{}.}{NWNVxch-3XNgJW-1}{\nwixu{NWNVxch-2hXnLe-1}\nwixd{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{c}{{Test the private functions in \code{}lol.wizard5\edoc{}}{NWNVxch-386mef-1}{\nwixu{NWNVxch-2hXnLe-1}\nwixd{NWNVxch-386mef-1}}}%
\nwixlogsorted{c}{{test/wizard5.lisp}{NWNVxch-2hXnLe-1}{\nwixd{NWNVxch-2hXnLe-1}}}%
\nwixlogsorted{c}{{the object is on the floor}{NWNVxch-ZgAXP-1}{\nwixd{NWNVxch-ZgAXP-1}\nwixu{NWNVxch-1p0Y9w-A}}}%
\nwixlogsorted{c}{{try to go in that direction}{NWNVxch-1WD8QL-1}{\nwixd{NWNVxch-1WD8QL-1}\nwixu{NWNVxch-1p0Y9w-9}}}%
\nwixlogsorted{c}{{You've got whiskey!}{NWNVxch-4E6M4z-1}{\nwixd{NWNVxch-4E6M4z-1}\nwixu{NWNVxch-3XNgJW-1}}}%
\nwixlogsorted{i}{{\nwixident{*edges*}}{*edges*}}%
\nwixlogsorted{i}{{\nwixident{*location*}}{*location*}}%
\nwixlogsorted{i}{{\nwixident{*nodes*}}{*nodes*}}%
\nwixlogsorted{i}{{\nwixident{*object-locations*}}{*object-locations*}}%
\nwixlogsorted{i}{{\nwixident{*objects*}}{*objects*}}%
\nwixlogsorted{i}{{\nwixident{describe-location}}{describe-location}}%
\nwixlogsorted{i}{{\nwixident{describe-objects}}{describe-objects}}%
\nwixlogsorted{i}{{\nwixident{describe-path}}{describe-path}}%
\nwixlogsorted{i}{{\nwixident{describe-paths}}{describe-paths}}%
\nwixlogsorted{i}{{\nwixident{inventory}}{inventory}}%
\nwixlogsorted{i}{{\nwixident{lol.wizard5}}{lol.wizard5}}%
\nwixlogsorted{i}{{\nwixident{look}}{look}}%
\nwixlogsorted{i}{{\nwixident{objects-at}}{objects-at}}%
\nwixlogsorted{i}{{\nwixident{pickup}}{pickup}}%
\nwixlogsorted{i}{{\nwixident{walk}}{walk}}%
\nwbegindocs{137}\nwdocspar

\begin{minted}[gobble=2]{shell-session}
  $ ./bin/runtests
  Summary:
    All 1 file passed.
\end{minted}


\newpage
\newgeometry{left=0.625in,right=3.75in}
\setlength{\linewidth}{1.8\textwidth}
\begin{multicols*}{2}
[\section{Full Listing}]
\inputminted[linenos,lastline=50,fontsize=\footnotesize]{lisp}{src/wizard5.lisp}
\columnbreak
\inputminted[linenos,firstline=53,lastline=85,fontsize=\footnotesize]{lisp}{src/wizard5.lisp}
\newpage
\inputminted[linenos,firstline=87,fontsize=\footnotesize]{lisp}{src/wizard5.lisp}
\end{multicols*}
\restoregeometry


% \section{Example Session}

% After loading \srclink{src/wizard5.lisp},
% you might have {\Tt{}\LA{}session~{\nwtagstyle{}\subpageref{nw@notdef}}\RA{}\nwendquote} like this.

% \begin{marginfigure}
% \begin{minted}{shell-session}
% $ rlwrap sbcl --load src/wizard5.lisp
% \end{minted}
% \end{marginfigure}


\newpage
\setlength{\linewidth}{2\textwidth}
\begin{multicols}{2}
  \section{Chunks}
  \nowebchunks
  \columnbreak

  \section{Index}
  \nowebindex
\end{multicols}


\setlength{\linewidth}{1.4\textwidth}

\bibliography{lol}
\bibliographystyle{plainnat}


\end{document}
\nwenddocs{}
