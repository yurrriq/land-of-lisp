% -*- mode: noweb; ess-noweb-default-code-mode: lisp-mode; -*-% ===> this file was generated automatically by noweave --- better not edit it
\documentclass{tufte-handout}

\input{preamble.tex}

\usepackage[xindy,nopostdot]{glossaries}
\makeglossaries
\input{glossary}

\hypersetup{
  pdffitwindow=true,
  pdfstartview={FitH},
  pdftitle={Pudding Eater},
  pdfauthor={Eric Bailey <eric@ericb.me>},
  pdfsubject={Land of Lisp: Chapter 4},
  pdfkeywords={Lisp, silly, literate programming, noweb},
  colorlinks=true,
  linkcolor=ErlangRed,
  urlcolor=ErlangRed
}

\title{%
  Pudding Eater
  \thanks{\cite{barski2010land-ch4}}
}

\date{%
  October 10, 2017
  \thanks{Last updated \today}
}

\begin{document}
\maketitle
\nwfilename{src/pudding.nw}\nwbegindocs{1}\nwdocspar

\begin{abstract}
  Who ate my pudding?
\end{abstract}

\begin{marginfigure}
\srclink{src/pudding.lisp}:
\nwenddocs{}\nwbegincode{2}\sublabel{NWlm77s-1p0Y9w-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-1p0Y9w-1}}}\moddef{*~{\nwtagstyle{}\subpageref{NWlm77s-1p0Y9w-1}}}\endmoddef\nwstartdeflinemarkup\nwprevnextdefs{\relax}{NWlm77s-1p0Y9w-2}\nwenddeflinemarkup
(in-package :cl-user)
(defpackage \nwlinkedidentc{lol.pudding}{NWlm77s-1p0Y9w-1}
  (:use :cl :prove)
  (:export \nwlinkedidentc{pudding-eater}{NWlm77s-1p0Y9w-3}))
(in-package :\nwlinkedidentc{lol.pudding}{NWlm77s-1p0Y9w-1})


\nwindexdefn{\nwixident{lol.pudding}}{lol.pudding}{NWlm77s-1p0Y9w-1}\eatline
\nwalsodefined{\\{NWlm77s-1p0Y9w-2}\\{NWlm77s-1p0Y9w-3}}\nwnotused{*}\nwidentdefs{\\{{\nwixident{lol.pudding}}{lol.pudding}}}\nwidentuses{\\{{\nwixident{pudding-eater}}{pudding-eater}}}\nwindexuse{\nwixident{pudding-eater}}{pudding-eater}{NWlm77s-1p0Y9w-1}\nwendcode{}\nwbegindocs{3}\end{marginfigure}


% \tableofcontents
% \newpage


\section{Defining the Arch-Enemy Variable}

Since at first we don't know who the pudding eater\newline
\noindent (a.k.a. our {\Tt{}\nwlinkedidentq{*arch-enemy*}{NWlm77s-1p0Y9w-2}\nwendquote}) is, set the initial value to \gls{nil}.

\marginnote[1.5\baselineskip]{%
  \say{Global variable names should start and end with asterisks (also known in
    this context as earmuffs)} \citep{google-style-guide}.
}

\nwenddocs{}\nwbegincode{4}\sublabel{NWlm77s-1p0Y9w-2}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-1p0Y9w-2}}}\moddef{*~{\nwtagstyle{}\subpageref{NWlm77s-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWlm77s-1p0Y9w-1}{NWlm77s-1p0Y9w-3}\nwenddeflinemarkup
(defvar \nwlinkedidentc{*arch-enemy*}{NWlm77s-1p0Y9w-2} nil)\nwindexdefn{\nwixident{*arch-enemy*}}{*arch-enemy*}{NWlm77s-1p0Y9w-2}


\nwidentdefs{\\{{\nwixident{*arch-enemy*}}{*arch-enemy*}}}\nwendcode{}\nwbegindocs{5}\nwdocspar


\section{Defining the Pudding-Eater Function}

This chapter introduces \lsp{cond}, an extremely versatile function that's
\say{been around sine the Lisp Stone Age.} The basic form is as follows.

\begin{minted}{lisp}
(cond (test-form form*)
      ...)
\end{minted}

\begin{marginfigure}
  \includegraphics[width=\textwidth]{lisplogo_alien.eps}
  \caption{Henry, the Lisp Alien}
  \label{fig:lisp-alien}
\end{marginfigure}

Since \lsp{test-form}s are evaluated for truthiness, we can branch on which
\lsp{person} ate our pudding.

\begin{marginfigure}
\nwenddocs{}\nwbegincode{6}\sublabel{NWlm77s-e7MAZ-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-e7MAZ-1}}}\moddef{it was Henry~{\nwtagstyle{}\subpageref{NWlm77s-e7MAZ-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWlm77s-2TVrZS-1}}\nwenddeflinemarkup
(eq person 'henry)
\nwused{\\{NWlm77s-2TVrZS-1}}\nwendcode{}\nwbegindocs{7}\nwdocspar
\end{marginfigure}

If {\Tt{}\LA{}it was Henry~{\nwtagstyle{}\subpageref{NWlm77s-e7MAZ-1}}\RA{}\nwendquote}, the Lisp alien,
\nwenddocs{}\nwbegincode{8}\sublabel{NWlm77s-zhIxQ-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-zhIxQ-1}}}\moddef{blame Henry.~{\nwtagstyle{}\subpageref{NWlm77s-zhIxQ-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWlm77s-2TVrZS-1}\\{NWlm77s-1p0Y9w-3}}\nwenddeflinemarkup
(setf \nwlinkedidentc{*arch-enemy*}{NWlm77s-1p0Y9w-2} 'stupid-lisp-alien)
'(curse you lisp alien - you ate my pudding)
\nwused{\\{NWlm77s-2TVrZS-1}\\{NWlm77s-1p0Y9w-3}}\nwidentuses{\\{{\nwixident{*arch-enemy*}}{*arch-enemy*}}}\nwindexuse{\nwixident{*arch-enemy*}}{*arch-enemy*}{NWlm77s-zhIxQ-1}\nwendcode{}\nwbegindocs{9}\nwdocspar

\begin{marginfigure}
\nwenddocs{}\nwbegincode{10}\sublabel{NWlm77s-23wlyr-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-23wlyr-1}}}\moddef{it was Johnny~{\nwtagstyle{}\subpageref{NWlm77s-23wlyr-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWlm77s-2TVrZS-1}}\nwenddeflinemarkup
(eq person 'johnny)
\nwused{\\{NWlm77s-2TVrZS-1}}\nwendcode{}\nwbegindocs{11}\nwdocspar
\end{marginfigure}

If {\Tt{}\LA{}it was Johnny~{\nwtagstyle{}\subpageref{NWlm77s-23wlyr-1}}\RA{}\nwendquote},
\nwenddocs{}\nwbegincode{12}\sublabel{NWlm77s-3Ska6D-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-3Ska6D-1}}}\moddef{blame Johnny.~{\nwtagstyle{}\subpageref{NWlm77s-3Ska6D-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWlm77s-2TVrZS-1}\\{NWlm77s-1p0Y9w-3}}\nwenddeflinemarkup
(setf \nwlinkedidentc{*arch-enemy*}{NWlm77s-1p0Y9w-2} 'useless-old-johnny)
'(i hope you choked on my pudding johnny)
\nwused{\\{NWlm77s-2TVrZS-1}\\{NWlm77s-1p0Y9w-3}}\nwidentuses{\\{{\nwixident{*arch-enemy*}}{*arch-enemy*}}}\nwindexuse{\nwixident{*arch-enemy*}}{*arch-enemy*}{NWlm77s-3Ska6D-1}\nwendcode{}\nwbegindocs{13}\nwdocspar

\begin{marginfigure}
\nwenddocs{}\nwbegincode{14}\sublabel{NWlm77s-FC5AE-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-FC5AE-1}}}\moddef{ask them why.~{\nwtagstyle{}\subpageref{NWlm77s-FC5AE-1}}}\endmoddef\nwstartdeflinemarkup\nwusesondefline{\\{NWlm77s-2TVrZS-1}\\{NWlm77s-1p0Y9w-3}}\nwenddeflinemarkup
'(why you eat my pudding stranger ?)
\nwused{\\{NWlm77s-2TVrZS-1}\\{NWlm77s-1p0Y9w-3}}\nwendcode{}\nwbegindocs{15}\nwdocspar
\end{marginfigure}

If it was someone else, {\Tt{}\LA{}ask them why.~{\nwtagstyle{}\subpageref{NWlm77s-FC5AE-1}}\RA{}\nwendquote}.

\newpage
The \lsp{cond} version of {\Tt{}\nwlinkedidentq{pudding-eater}{NWlm77s-1p0Y9w-3}\nwendquote} then, would look like this:

\nwenddocs{}\nwbegincode{16}\sublabel{NWlm77s-2TVrZS-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-2TVrZS-1}}}\moddef{\code{}cond\edoc{}-flavoured \code{}pudding-eater\edoc{}~{\nwtagstyle{}\subpageref{NWlm77s-2TVrZS-1}}}\endmoddef\nwstartdeflinemarkup\nwenddeflinemarkup
(Î» (person)
  (cond (\LA{}it was Johnny~{\nwtagstyle{}\subpageref{NWlm77s-23wlyr-1}}\RA{} \LA{}blame Johnny.~{\nwtagstyle{}\subpageref{NWlm77s-3Ska6D-1}}\RA{})
        (\LA{}it was Henry~{\nwtagstyle{}\subpageref{NWlm77s-e7MAZ-1}}\RA{}  \LA{}blame Henry.~{\nwtagstyle{}\subpageref{NWlm77s-zhIxQ-1}}\RA{})
        (t                \LA{}ask them why.~{\nwtagstyle{}\subpageref{NWlm77s-FC5AE-1}}\RA{})))
\nwnotused{[[cond]]-flavoured [[pudding-eater]]}\nwendcode{}\nwbegindocs{17}\nwdocspar

More succinctly, with \lsp{case}, we can define the {\Tt{}\nwlinkedidentq{pudding-eater}{NWlm77s-1p0Y9w-3}\nwendquote} function.

\nwenddocs{}\nwbegincode{18}\sublabel{NWlm77s-1p0Y9w-3}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-1p0Y9w-3}}}\moddef{*~{\nwtagstyle{}\subpageref{NWlm77s-1p0Y9w-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NWlm77s-1p0Y9w-2}{\relax}\nwenddeflinemarkup
(defun \nwlinkedidentc{pudding-eater}{NWlm77s-1p0Y9w-3} (person)\nwindexdefn{\nwixident{pudding-eater}}{pudding-eater}{NWlm77s-1p0Y9w-3}
  (case person
        ((henry)   \LA{}blame Henry.~{\nwtagstyle{}\subpageref{NWlm77s-zhIxQ-1}}\RA{})
        ((johnny)  \LA{}blame Johnny.~{\nwtagstyle{}\subpageref{NWlm77s-3Ska6D-1}}\RA{})
        (otherwise \LA{}ask them why.~{\nwtagstyle{}\subpageref{NWlm77s-FC5AE-1}}\RA{})))
\nwidentdefs{\\{{\nwixident{pudding-eater}}{pudding-eater}}}\nwendcode{}\nwbegindocs{19}\nwdocspar


% \section{Full Listing}

% \inputminted[linenos]{lisp}{pudding.lisp}


\section{Tests}

\nwenddocs{}\nwbegincode{20}\sublabel{NWlm77s-2h6Bp2-1}\nwmargintag{{\nwtagstyle{}\subpageref{NWlm77s-2h6Bp2-1}}}\moddef{test/pudding.lisp~{\nwtagstyle{}\subpageref{NWlm77s-2h6Bp2-1}}}\endmoddef\nwstartdeflinemarkup\nwenddeflinemarkup
(in-package :\nwlinkedidentc{lol.pudding}{NWlm77s-1p0Y9w-1})


(plan 1)


(subtest "A Plausible Session"
  (is (\nwlinkedidentc{pudding-eater}{NWlm77s-1p0Y9w-3} 'johnny)
      '(I HOPE YOU CHOKED ON MY PUDDING JOHNNY)
      "I hope you choked on my pudding, Johnny!")
  (is \nwlinkedidentc{*arch-enemy*}{NWlm77s-1p0Y9w-2}
      'USELESS-OLD-JOHNNY
      "Useless old Johnny!")
  (is (\nwlinkedidentc{pudding-eater}{NWlm77s-1p0Y9w-3} 'george-clooney)
      '(WHY YOU EAT MY PUDDING STRANGER ?)))


(finalize)
\nwnotused{test/pudding.lisp}\nwidentuses{\\{{\nwixident{*arch-enemy*}}{*arch-enemy*}}\\{{\nwixident{lol.pudding}}{lol.pudding}}\\{{\nwixident{pudding-eater}}{pudding-eater}}}\nwindexuse{\nwixident{*arch-enemy*}}{*arch-enemy*}{NWlm77s-2h6Bp2-1}\nwindexuse{\nwixident{lol.pudding}}{lol.pudding}{NWlm77s-2h6Bp2-1}\nwindexuse{\nwixident{pudding-eater}}{pudding-eater}{NWlm77s-2h6Bp2-1}\nwendcode{}

\nwixlogsorted{c}{{*}{NWlm77s-1p0Y9w-1}{\nwixd{NWlm77s-1p0Y9w-1}\nwixd{NWlm77s-1p0Y9w-2}\nwixd{NWlm77s-1p0Y9w-3}}}%
\nwixlogsorted{c}{{\code{}cond\edoc{}-flavoured \code{}pudding-eater\edoc{}}{NWlm77s-2TVrZS-1}{\nwixd{NWlm77s-2TVrZS-1}}}%
\nwixlogsorted{c}{{ask them why.}{NWlm77s-FC5AE-1}{\nwixd{NWlm77s-FC5AE-1}\nwixu{NWlm77s-2TVrZS-1}\nwixu{NWlm77s-1p0Y9w-3}}}%
\nwixlogsorted{c}{{blame Henry.}{NWlm77s-zhIxQ-1}{\nwixd{NWlm77s-zhIxQ-1}\nwixu{NWlm77s-2TVrZS-1}\nwixu{NWlm77s-1p0Y9w-3}}}%
\nwixlogsorted{c}{{blame Johnny.}{NWlm77s-3Ska6D-1}{\nwixd{NWlm77s-3Ska6D-1}\nwixu{NWlm77s-2TVrZS-1}\nwixu{NWlm77s-1p0Y9w-3}}}%
\nwixlogsorted{c}{{it was Henry}{NWlm77s-e7MAZ-1}{\nwixd{NWlm77s-e7MAZ-1}\nwixu{NWlm77s-2TVrZS-1}}}%
\nwixlogsorted{c}{{it was Johnny}{NWlm77s-23wlyr-1}{\nwixd{NWlm77s-23wlyr-1}\nwixu{NWlm77s-2TVrZS-1}}}%
\nwixlogsorted{c}{{test/pudding.lisp}{NWlm77s-2h6Bp2-1}{\nwixd{NWlm77s-2h6Bp2-1}}}%
\nwixlogsorted{i}{{\nwixident{*arch-enemy*}}{*arch-enemy*}}%
\nwixlogsorted{i}{{\nwixident{lol.pudding}}{lol.pudding}}%
\nwixlogsorted{i}{{\nwixident{pudding-eater}}{pudding-eater}}%
\nwbegindocs{21}\nwdocspar


% \section{Index}
% \nowebindex


% \newpage
% \section{Chunks}
% \nowebchunks


\restoregeometry
\thanks{\cite{hyperspec-glossary}}
\printglossaries


\setlength{\linewidth}{1.4\textwidth}
\bibliography{lol}
\bibliographystyle{plainnat}

\end{document}
\nwenddocs{}
